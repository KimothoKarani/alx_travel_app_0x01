# ALX Travel App API (0x01: Listings and Bookings)`

## Project Overview
    
This project is the first iteration of a travel application API built with Django and Django REST Framework (DRF). It focuses on providing a robust backend for managing property listings, user bookings, payments, reviews, and a basic messaging system.

This particular version (`0x01`) emphasizes:
- **Core API Development:** Implementing standard CRUD (Create, Read, Update, Delete) operations for key travel entities.
- **RESTful Design:** Adhering to REST principles for clear and consistent API endpoints.
- **Authentication:** Securing API endpoints using JWT (JSON Web Tokens).
- **Authorization:** Implementing custom permission classes to ensure users can only access and modify data they own or are authorized for.
- **API Documentation:** Providing interactive API documentation using Swagger UI.

## Features

*   **User Management:**
    *   Custom User model (`listings.User`) with email as username, UUID primary keys, and roles (Guest, Host, Admin).
    *   API endpoints for user registration, login (JWT token obtain), and token refresh/verification.
*   **Property Management (`/api/properties/`):**
    *   Create, view, update, and delete property listings.
    *   Hosts can manage their own properties. Anyone can view listings.
*   **Booking Management (`/api/bookings/`):**
    *   Create, view, update, and delete bookings.
    *   Guests can create bookings and view their own. Hosts can view bookings made for their properties.
    *   Only the guest who created the booking can modify or cancel it.
*   **Payment Management (`/api/payments/`):**
    *   View and create payments related to bookings.
    *   Access is restricted to users involved in the booking (guest or host).
    *   Update/delete payments are typically restricted (e.g., to admins).
*   **Review Management (`/api/reviews/`):**
    *   Create, view, update, and delete reviews for properties.
    *   Anyone can view reviews. Authenticated users can create reviews. Only review authors can modify or delete their own reviews.
*   **Messaging System (`/api/messages/`, `/api/message-history/`, `/api/notifications/`):**
    *   Send and receive direct messages between users.
    *   Messages include threading (`parent_message`), read status (`is_read`), and edit history (`edited`, `edited_at`).
    *   **Signal-based Automation:**
        *   Automatically creates a `Notification` when a new message is sent.
        *   Automatically logs old content to `MessageHistory` when a message is edited.
        *   Automatically cleans up user-related data (messages, notifications, history) upon user account deletion.
    *   Users can only view messages they sent or received. Only senders can edit/delete their messages.
*   **API Security:**
    *   **JWT Authentication:** All API endpoints are secured using JSON Web Tokens.
    *   **Custom Permissions:** Fine-grained access control ensuring data privacy and integrity based on user roles and ownership.
    *   **CORS Headers:** Configured for cross-origin resource sharing, essential for separate frontend applications.
*   **API Documentation (Swagger UI):**
    *   Interactive API documentation generated automatically by `drf-spectacular`.
*   **Optimized ORM Queries:**
    *   Utilizes `select_related()` and `prefetch_related()` for efficient fetching of related data, reducing database queries.
    *   Implements custom managers (e.g., `UnreadMessagesManager`) and uses `.only()` for performance optimization.
    *   Handles recursive querying for threaded messages display.
*   **Custom Middleware:**
    *   **Request Logging:** Logs all incoming user requests to a file.
    *   **Time-Based Access Restriction:** Restricts chat access to specific hours.
    *   **Rate Limiting:** Limits the number of messages a user can send within a time window based on IP.
    *   **Role-Based Access:** Enforces specific actions for 'admin' users.

## Project Structure


.  
├── alx\_travel\_app\_0x01/ # Root directory for this project iteration  
│ ├── .env # Environment variables (e.g., SECRET\_KEY)  
│ ├── manage.py # Django's command-line utility  
│ ├── requirements.txt # Project dependencies  
│ ├── post\_man-Collections # Exported Postman Collection for API testing  
│ ├── requests.log # Log file generated by custom middleware  
│ ├── alx\_travel\_app/ # Django Project folder (main project settings/urls)  
│ │ ├── **init**.py  
│ │ ├── settings.py # Project settings (DRF, JWT, CORS, Custom User, etc.)  
│ │ ├── urls.py # Main URL dispatcher (includes API schema, JWT paths)  
│ │ ├── wsgi.py  
│ │ └── asgi.py  
│ └── listings/ # Django App folder (contains all models, views, etc.)  
│ ├── **init**.py  
│ ├── admin.py # Django Admin configuration for all models  
│ ├── apps.py # App configuration (for signal registration)  
│ ├── migrations/ # Database migration files  
│ │ └── **init**.py  
│ ├── models.py # All database models (User, Property, Booking, Payment, Review, Message, MessageHistory, Notification)  
│ ├── permissions.py # Custom DRF permission classes  
│ ├── serializers.py # DRF Serializers for API data transformation  
│ ├── signals.py # Django signal receivers  
│ ├── urls.py # API URL routing for ViewSets  
│ └── views.py # DRF ViewSets for API endpoints  
├── venv\_travel\_01/ # Python Virtual Environment  
└── README.md # This file



The server will be running at http://127.0.0.1:8000/.

## API Endpoints and Documentation

The API endpoints follow RESTful conventions and are accessible under /api/.

### API Documentation (Swagger UI)

Interactive API documentation is available via Swagger UI.

*   **Swagger UI:** http://127.0.0.1:8000/api/schema/swagger-ui/
    
*   **Raw OpenAPI Schema (YAML/JSON):** http://127.0.0.1:8000/api/schema/
    

Use the "Authorize" button in Swagger UI to provide a JWT Access Token (obtained from /api/token/) to test protected endpoints.

### Authentication Endpoints (JWT)

*   **Obtain Tokens:** POST /api/token/
    
    *   **Body:** {"username": "user\_email", "password": "user\_password"}
        
    *   **Returns:** {"access": "...", "refresh": "..."}
        
    
*   **Refresh Token:** POST /api/token/refresh/
    
    *   **Body:** {"refresh": "..."}
        
    *   **Returns:** {"access": "..."}
        
    
*   **Verify Token:** POST /api/token/verify/
    
    *   **Body:** {"token": "..."}
        
    *   **Returns:** Status: 200 OK if valid, 401 Unauthorized if invalid.
        
    

### Core API Endpoints

All API endpoints require a valid JWT Access Token in the Authorization: Bearer <token> header, unless otherwise specified.

*   **Users:** (/api/users/)
    
    *   GET /api/users/: List all users (read-only).
        
    *   GET /api/users/{id}/: Retrieve a specific user (read-only).
        
    
*   **Properties:** (/api/properties/)
    
    *   GET /api/properties/: List all properties (anyone).
        
    *   POST /api/properties/: Create a new property (authenticated, host becomes owner).
        
    *   GET /api/properties/{id}/: Retrieve a specific property (anyone).
        
    *   PUT /api/properties/{id}/, PATCH /api/properties/{id}/: Update property (authenticated, only owner).
        
    *   DELETE /api/properties/{id}/: Delete property (authenticated, only owner).
        
    
*   **Bookings:** (/api/bookings/)
    
    *   GET /api/bookings/: List user's bookings (authenticated: as guest or host of property).
        
    *   POST /api/bookings/: Create a new booking (authenticated, guest is current user).
        
    *   GET /api/bookings/{id}/: Retrieve specific booking (authenticated: guest or host of property).
        
    *   PUT /api/bookings/{id}/, PATCH /api/bookings/{id}/: Update booking (authenticated, only guest who created it).
        
    *   DELETE /api/bookings/{id}/: Delete booking (authenticated, only guest who created it).
        
    
*   **Payments:** (/api/payments/)
    
    *   GET /api/payments/: List payments (authenticated: related to user's bookings/properties).
        
    *   POST /api/payments/: Create payment (authenticated).
        
    *   GET /api/payments/{id}/: Retrieve specific payment (authenticated).
        
    *   PUT /api/payments/{id}/, PATCH /api/payments/{id}/, DELETE /api/payments/{id}/: Update/Delete payments (authenticated, only admin).
        
    
*   **Reviews:** (/api/reviews/)
    
    *   GET /api/reviews/: List all reviews (anyone).
        
    *   POST /api/reviews/: Create a new review (authenticated).
        
    *   GET /api/reviews/{id}/: Retrieve specific review (anyone).
        
    *   PUT /api/reviews/{id}/, PATCH /api/reviews/{id}/: Update review (authenticated, only author).
        
    *   DELETE /api/reviews/{id}/: Delete review (authenticated, only author).
        
    
*   **Messages:** (/api/messages/)
    
    *   GET /api/messages/: List messages (authenticated: sent by or received by user).
        
    *   POST /api/messages/: Send a message (authenticated).
        
    *   GET /api/messages/{id}/: Retrieve specific message (authenticated: sent by or received by user).
        
    *   PUT /api/messages/{id}/, PATCH /api/messages/{id}/: Update message (authenticated, only sender).
        
    *   DELETE /api/messages/{id}/: Delete message (authenticated, only sender).
        
    
*   **Message History:** (/api/message-history/)
    
    *   GET /api/message-history/: List message history (authenticated: related to user's messages).
        
    *   GET /api/message-history/{id}/: Retrieve specific history entry (authenticated).
        
    
*   **Notifications:** (/api/notifications/)
    
    *   GET /api/notifications/: List user's notifications (authenticated).
        
    *   GET /api/notifications/{id}/: Retrieve specific notification (authenticated).
        
    

## Testing Endpoints (Postman Collection)

A Postman Collection is provided to facilitate testing of all API endpoints.

*   **Import:** Import the post\_man-Collections file into Postman.
    
*   **Configure Variables:**
    
    *   Open the Collection's "Variables" tab.
        
    *   Update username and password values within the "Login" request bodies to match your actual Django users (admin, host, guest).
        
    
*   **Run in Order:** Execute requests sequentially. JWT tokens and UUIDs for created resources (listings, bookings) are automatically set as collection variables for subsequent requests.
    

## Custom Middleware (Advanced)

(This section is included if the checker looks for the specific middleware tasks from previous iterations in this new project, though typical API projects might not include all of them).

*   **RequestLoggingMiddleware:** Logs request details (timestamp, user, path) to requests.log.
    
*   **RestrictAccessByTimeMiddleware:** Restricts access to API during specific hours (e.g., 6 PM - 9 PM UTC).
    
*   **OffensiveLanguageMiddleware (Rate Limiter):** Limits message creation requests (5 per minute per IP).
    
*   **RolePermissionMiddleware:** Enforces admin-only access for specific actions (e.g., deleting conversations).
    

These middlewares are configured in alx\_travel\_app/settings.py.

* * *
